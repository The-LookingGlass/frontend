var markerCluster,markerObjGlobal,markers=[],aMarkers=[];function myMap(){var s=getAllUrlParams().county;try{readTextFile("data/job_data.json",function(e){var r=JSON.parse(e),n=initMap(r,s);markerpPlacement(r,n,s),setMapOnAll(n);new Vue({el:"#floating-panel",methods:{changeCenter:function(){s=getAllUrlParams().county;var e=markers;setMapOnAll(null),markers=[];var a=initMap(r,s);if(markers=e,setMapOnAll(a),"DUBLIN"==s.toUpperCase()){markerCluster=new MarkerClusterer(a,markers,{imagePath:"images/m"})}}}}),new Vue({el:"#floating-panel2",methods:{changeCenter:function(){var e=getAllUrlParams().county;setMapOnAll(null),markers=[];var a=initMap(r,e);markerpPlacement(r,a,e),setMapOnAll(a)}}}),new Vue({el:"#dropDownVue",data:{range:"default"},methods:{test:function(){var e;if(s=getAllUrlParams().county,n=initMap(r,s),null==markerObjGlobal)resetMap(r);else{var a;(e=markerObjGlobal).setMap(n);var t={lat:e.getPosition().lat(),lng:e.getPosition().lng()};switch(this.range){case"500":a={max:499,min:0};break;case"1000":a={max:999,min:500};break;case"1500":a={max:1499,min:1e3};break;case"2000":a={max:2e3,min:1500};break;default:a={max:1e3,min:0}}placeHomeMarker(n,t,s,a)}}}})})}catch(e){console.log(e.message)}}function calculateDistance(e,a,t,r){var n=function(e){return e*Math.PI/180},s=n(t-e),i=n(r-a),l=Math.sin(s/2)*Math.sin(s/2)+Math.cos(n(e)*Math.cos(n(t)))*Math.sin(i/2)*Math.sin(i/2);return 6378137*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))/1e3}function initMap(e,a){var t=e[a].longitude,r=e[a].latitude,n=e[a].zoom,s={center:new google.maps.LatLng(r,t),zoom:n,styles:[{featureType:"landscape.natural",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#e0efef"}]},{featureType:"poi",elementType:"geometry.fill",stylers:[{visibility:"on"},{hue:"#1900ff"},{color:"#c0e8e8"}]},{featureType:"road",elementType:"geometry",stylers:[{lightness:100},{visibility:"simplified"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{visibility:"on"},{lightness:700}]},{featureType:"water",elementType:"all",stylers:[{color:"#7dcdcd"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]};return new google.maps.Map(document.getElementById("googleMap"),s)}function addMarker(e,a,t,r,n,s){var i=new google.maps.Marker({position:new google.maps.LatLng(e.ID[t].lat,e.ID[t].lng),info:new google.maps.InfoWindow({content:r}),icon:{url:n,scaledSize:new google.maps.Size(32,32)},animation:google.maps.Animation.DROP,url:s,map:a});return google.maps.event.addListener(i,"mouseover",function(){this.info.open(a,this)}),google.maps.event.addListener(i,"mouseout",function(){this.info.close()}),i}function setMapOnAll(e){for(var a=0;a<markers.length;a++)markers[a].setMap(e)}function markerpPlacement(t,r,n,s){for(var e=Object.keys(t.ID).length,a=getAllUrlParams().industry,i=0;i<e;i++){var l=t.ID[i].county,o=t.ID[i].industry;try{if(void 0!==l&&a==o&&(l.toUpperCase()==n.toUpperCase()||l.toUpperCase().includes(n.toUpperCase()))){var m=t.ID[i].joburl,c=t.ID[i].salary,p=t.ID[i].homepage;if(null!==p)var g="<div style='float:left'><img src='http://i.stack.imgur.com/g672i.png'></div><div style = 'float:right; padding:10px; font-size:18px'><strong>"+t.ID[i].title+"</strong><br><br><strong>COMPANY: </strong>"+t.ID[i].company.toUpperCase()+"<br><strong>SALARY: </strong>"+c+"<br><strong>HOMEPAGE: </strong>"+p+"</div>";else g="<div style='float:left'><img src='http://i.stack.imgur.com/g672i.png'></div><div style = 'float:right; padding:10px; font-size:18px'><strong>"+t.ID[i].title+"</strong><br><br><strong>COMPANY: </strong>"+t.ID[i].company.toUpperCase()+"<br><strong>SALARY: </strong>"+c+"</div>";var u=addMarker(t,r,i,g,"images/standardMarker.svg",m);markers.push(u);var d=!1;google.maps.event.addListener(u,"click",function(e){if(markerObjGlobal=this,d)null==this.url||"null"==this.url?console.log("error"):window.open(this.url),d=!1;else{r=initMap(t,n),this.setMap(r);var a={lat:e.latLng.lat(),lng:e.latLng.lng()};null==s&&(s={max:2e3,min:1e3}),placeHomeMarker(r,a,n,s),d=!0}})}}catch(e){console.log(e.message)}}if("DUBLIN"==n.toUpperCase()){markerCluster=new MarkerClusterer(r,markers,{imagePath:"images/m"})}}function placeHomeMarker(r,n,s,i){try{readTextFile("data/coordinates_myhome.json",function(e){var a=0,t={minDistance:0,maxDistance:5,data:JSON.parse(e)};(a=autoDistance(t,r,s,n,i,a))<3&&(a=a,t.minDistance=5,t.maxDistance=10,a=autoDistance(t,r,s,n,i,a)),a<3&&(a=a,t.minDistance=10,t.maxDistance=20,a=autoDistance(t,r,s,n,i,a)),a<3&&console.log("this county is doomed!");new MarkerClusterer(r,aMarkers,{imagePath:"images/m"})})}catch(e){console.log(e.message)}}function autoDistance(e,a,t,r,n,s){var i,l;aMarkers=[];var o=Object.keys(e.data.ID).length;switch(e.maxDistance){case 5:i=5e3,cicleColor="#228b22";break;case 10:i=1e4,l="#ffe200";break;case 20:i=2e4,l="#ff0000";break;default:i=5e3,cicleColor="#228b22"}for(var m=0;m<o;m++){var c=e.data.ID[m].address;if(c.toUpperCase().includes(t.toUpperCase())){var p=calculateDistance(r.lat,r.lng,e.data.ID[m].lat,e.data.ID[m].lng),g=e.data.ID[m].price;new google.maps.Circle({strokeColor:l,strokeOpacity:.2,strokeWeight:2,fillOpacity:0,map:a,center:r,radius:i});if(g>n.min&&g<n.max&&p>e.minDistance&&p<e.maxDistance){s+=1;var u="<div id='img' style='float:left'><img src='http://i.stack.imgur.com/g672i.png'></div><div style = 'float:right; padding: 10px; font-size:18px'><strong>COST: "+g+"â‚¬</strong><br><br><strong>ADDRESS: </stong>"+c+"</div>",d=e.data.ID[m].url,f=addMarker(e.data,a,m,u,"images/home.svg",d);aMarkers.push(f),google.maps.event.addListener(f,"click",function(){window.open(this.url,"_blank")})}}}return s}function resetMap(e){county=getAllUrlParams().county;var a=markers;setMapOnAll(null),markers=[];var t=initMap(e,county);if(markers=a,setMapOnAll(t),"DUBLIN"==county.toUpperCase()){markerCluster=new MarkerClusterer(t,markers,{imagePath:"images/m"})}}function readTextFile(e,a){var t=new XMLHttpRequest;t.overrideMimeType("application/json"),t.open("GET",e,!0),t.onreadystatechange=function(){4===t.readyState&&"200"==t.status&&a(t.responseText)},t.send(null)}function getAllUrlParams(e){var a=e?e.split("?")[1]:window.location.search.slice(1),t={};if(a)for(var r=(a=a.split("#")[0]).split("&"),n=0;n<r.length;n++){var s=r[n].split("="),i=void 0,l=s[0].replace(/\[\d*\]/,function(e){return i=e.slice(1,-1),""}),o=void 0===s[1]||s[1];l=l.toLowerCase(),o=o.toLowerCase(),t[l]?("string"==typeof t[l]&&(t[l]=[t[l]]),void 0===i?t[l].push(o):t[l][i]=o):t[l]=o}return t}